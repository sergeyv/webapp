<%page args="field" />
<%
if field.widget.addremove is True:
    addremoveclass = ' addremove'
else:
    addremoveclass = ''
if field.widget.sortable is True:
    sortableclass = ' sortable'
else:
    sortableclass = ''

%>
<fieldset id="${field.cssname}--field" class="${field.classes}${addremoveclass}${sortableclass}">
  <span class="formish-sequencedata" title="batch_add_count=${field.widget.batch_add_count}"> </span>
${field.seqdelete()|n}
${field.seqgrab()|n}
${field.label()|n}
${field.error()|n}
${field.fields()|n}
${field.description()|n}

<%!
from urllib import quote
%>

<%
child_schema = field.template
%>

<%def name="fieldtemplate(f)">
  ${quote(field.widget.child_schema_as_a_row(f).encode('utf-8'))|n}
</%def>

<table class="listingTable">
<thead>
<tr>
% for f in child_schema.fields:
    <th style="${field.widget.column_visibility(f)}">${f.title|n }</th>
% endfor
    <th>&nbsp;</th>
</tr>
</thead>

<tbody>
</tbody>

<!--
<tbody class="existingItems">
</tbody>

<tbody class="newItems">
</tbody>
-->

</table>

<input type="hidden" name="${child_schema.name}" class="adder" value="${fieldtemplate(child_schema)}" />

</fieldset>
