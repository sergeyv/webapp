<%page args="field" />

<select id='date_select' name='date_select'>
	<option value='today'>Today</option>
	<option value='tomorrow'>Tomorrow</option>
	<option value='this week'>This week</option>
	<option value='next week'>Next week</option>
	<option value='later'>Later</option>
	<option value='datepicker'>Specific date</option>
</select>
<div id="${field.cssname}-display" style="margin-left: 150px"></div>
<input id="${field.cssname}" type="hidden" name="${field.name}" value="" />

<script type="text/javascript">
	function convertDateTime(date) {
		var datetime;
		var month = (date.getMonth()+1);
		if (month < 10)
			month = "0" + month;
		datetime = date.getFullYear() + "-" + month + "-" + date.getDate() + " ";
		
		var suffix = "am";
		var hours = date.getHours();
		var minutes = date.getMinutes();
		if (minutes < 10)
			minutes = "0" + minutes;
		if (hours >= 12) {
			suffix = "pm";
			hours -= 12;
		}
		if (hours == 0) {
			hours = 12;
		}
		
		return datetime + hours + ":" + minutes + " " + suffix;
	};


	$("#date_select").chosen({
		disable_search_threshold: 10
	});

    $("#${field.cssname}-display").datetimepicker({
        changeYear:true,
        changeMonth:true,
        dateFormat: "yy-mm-dd",
        timeFormat: "hh:mm tt",
        controlType: "select",
        onSelect: function (dateText, inst) {
    		$("#${field.cssname}").attr("value", dateText);
    		console.log($("#${field.cssname}").val());
    	},
    });
    
    $("#${field.cssname}-display").hide();
    
    var now = new Date();
	now.setDate(now.getDate() + 1);
	$("#${field.cssname}").attr("value", now.toISOString());
    
    $("#date_select").change(function() {
    	if ($(this).val() == "datepicker") {
			$("#${field.cssname}-display").show();
    	} else {
    		var dateText;
    		
			$("#${field.cssname}-display").hide();
			
			var today = new Date();
			today.setDate(today.getDate() + 1);
			var tomorrow = new Date();
			tomorrow.setDate(tomorrow.getDate() + 2);
			var this_week = new Date();
			this_week.setDate(this_week.getDate() - this_week.getDay());
			this_week.setDate(this_week.getDate() + 6);
			var next_week = new Date();
			next_week.setDate(this_week.getDate() + 7);
			var later = new Date();
			later.setDate(next_week.getDate() + 7);
			
			if ($(this).val() == "today") {
				dateText = convertDateTime(today);
			} else if ($(this).val() == "tomorrow") {
				dateText = convertDateTime(tomorrow);
			} else if ($(this).val() == "this week") {
				dateText = convertDateTime(this_week);
			} else if ($(this).val() == "next week") {
				dateText = convertDateTime(next_week);
			} else if ($(this).val() == "later") {
				dateText = convertDateTime(later);
			} 
			
    		$("#${field.cssname}").attr("value", dateText);
    		console.log($("#${field.cssname}").val());
    	}
    });
</script>

